/*
 *  OAC Video Annotation Tool v0.1
 * 
 *  Developed as a plugin for the MITHGrid framework. 
 *  
 *  Date: Fri Oct 21 08:15:59 2011 -0700
 *  
 * Educational Community License, Version 2.0
 * 
 * Copyright 2011 University of Maryland. Licensed under the Educational
 * Community License, Version 2.0 (the "License"); you may not use this file
 * except in compliance with the License. You may obtain a copy of the License at
 * 
 * http://www.osedu.org/licenses/ECL-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations under
 * the License.
 * 
 */
var MITHGrid=MITHGrid||{},jQuery=jQuery||{},Raphael=Raphael||{},OAC=OAC||{};(function(a,b){b.Presentation.namespace("RaphaelCanvas"),b.Presentation.RaphaelCanvas.initPresentation=function(c,d){var e=b.Presentation.initPresentation("RaphaelCanvas",c,d),f=a(c).attr("id"),g,h;d.cWidth!==undefined?h=d.cWidth:h=a(c).width(),d.cHeight!==undefined?g=d.cHeight:g=a(c).height(),e.canvas=new Raphael(f,h,g);return e}})(jQuery,MITHGrid),function(a,b,c){b.globalNamespace("OAC"),c.namespace("Client"),c.Client.namespace("StreamingVideo"),c.Client.StreamingVideo.initApp=function(d,e){var f,g,h;g=c.Client.StreamingVideo.Controller.annotationShapeDragController({}),f=b.Application.initApp("OAC.Client.StreamingVideo",d,a.extend(!0,{},e,{dataViews:{drawspace:{dataStore:"canvas",types:["Rectangle","Ellipse"],label:"drawspace"}},viewSetup:'<div id="canvasSVG"></div><div class="anno_list"></div>',presentations:{raphsvg:{type:b.Presentation.RaphaelCanvas,container:"#canvasSVG",dataView:"drawspace",lenses:{Rectangle:function(b,c,d,e){var f={},h=d.getItem(e),i,j,k;a("#testdone").append("<p>Raphael Object in data store:<br/> "+JSON.stringify(h)+"</p>"),j=h.x-h.w/2,k=h.y-h.h/2,i=c.canvas.rect(j,k,h.w,h.h),i.attr({fill:"red",opacity:1}),g.bind(i,{model:d,itemId:e,x:"x",y:"y"}),f.update=function(a){try{a.x!==undefined&&a.y!==undefined&&i.attr({x:a.x[0],y:a.y[0]})}catch(b){console.log(b)}},f.remove=function(a){i.remove()};return f},Ellipse:function(a,b,c,d){var e={},f=c.getItem(d),h;h=b.canvas.ellipse(f.x[0],f.y[0],f.w[0],f.h[0]),h.attr({fill:"red"}),g.bind(h,{model:c,itemId:d,x:"cx",y:"cy"}),e.update=function(a){try{a.x!==undefined&&a.y!==undefined&&h.attr({cx:a.x[0],cy:a.y[0]})}catch(b){console.log(b)}},e.remove=function(){h.remove()};return e}}},annoItem:{type:b.Presentation.SimpleText,dataView:"drawspace",container:".anno_list",lenses:{Rectangle:function(b,c,d,e){var f={},g=d.getItem(e);a("#delete"+g.id[0]).live("click",function(a){a.preventDefault(),d.removeItems([g.id[0]])}),h(g,b),f.update=function(a){h(a,b)},f.remove=function(){a("#"+g.id).remove()};return f},Ellipse:function(b,c,d,e){var f={},g=d.getItem(e);a("#delete"+g.id[0]).live("click",function(a){a.preventDefault(),d.removeItems([g.id[0]])}),h(g,b),f.update=function(a){h(a,b)},f.remove=function(){a("#"+g.id).remove()};return f}}}},cWidth:e.width,cHeight:e.height})),h=function(b,c){var d='<div id="'+b.id[0]+'" class="anno_item">'+"<p>"+b.creator[0]+"</p>"+"<p>"+b.bodyContent[0]+"</p>"+"<p>"+b.x[0]+"<br/>"+b.y[0]+"<br/>"+b.w[0]+"<br/>"+b.h[0]+"</p>"+'<div id="delete'+b.id[0]+'">X</div>'+"</div>";a("#"+b.id[0]).remove(),a(c).append(d)},f.ready(function(){});return f}}(jQuery,MITHGrid,OAC),MITHGrid.defaults("OAC.Client.StreamingVideo",{dataStores:{canvas:{types:{Rectangle:{},Ellipse:{}},properties:{bodyContent:{type:"String"},targetURI:{type:"Item"}}}}}),function(a,b,c){c.Client.StreamingVideo.namespace("Controller"),c.Client.StreamingVideo.Controller.annotationShapeDragController=function(a){that=b.Controller.initRaphaelController("OAC.Client.StreamingVideo.Controller.annotationShapeDragController",a),that.applyBindings=function(a,b){var c,d,e;e=a.locate("raphael"),e.drag(function(a,e){b.model.updateItems([{id:b.itemId,x:c+a,y:d+e}])},function(){c=parseInt(e.attr(b.x),10),d=parseInt(e.attr(b.y),10)},function(){})};return that}}(jQuery,MITHGrid,OAC);