/*
 *  OAC Video Annotation Tool
 * 
 *  Developed as a plugin for the MITHGrid framework. 
 *  
 *  Date: Fri Sep 30 11:42:08 2011 -0400
 *  
 * Educational Community License, Version 2.0
 * 
 * Copyright 2011 University of Maryland. Licensed under the Educational
 * Community License, Version 2.0 (the "License"); you may not use this file
 * except in compliance with the License. You may obtain a copy of the License at
 * 
 * http://www.osedu.org/licenses/ECL-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations under
 * the License.
 * 
 */
var MITHGrid=MITHGrid||{},jQuery=jQuery||{},fluid=fluid||{},Raphael=Raphael||{};(function(a,b){b.Presentation.namespace("RaphSVG"),b.Presentation.RaphSVG.initPresentation=function(c,d){var e=b.Presentation.initPresentation("RaphSVG",c,d),f=a(c).attr("id"),g,h;d.cWidth&&d.cHeight?(h=d.cWidth,g=d.cHeight):(h=a(c).width(),g=a(c).height()),e.canvas=new Raphael(f,h,g);return e}})(jQuery,MITHGrid),function(a,b){b.Application.namespace("Canvas"),b.Application.Canvas.initApp=function(c,d){var e=b.Application.initApp("MITHGrid.Application.Canvas",c,a.extend(!0,{},d,{dataViews:{drawspace:{dataStore:"canvas",types:["shape"],label:"drawspace"}},viewSetup:'<h3>Canvas Area</h3><div id="canvasSVG"></div><div id="testdone"></div><button id="loadrect">Load SVG Shape</button><button id="updaterect">Update Shape (Move it)</button>',presentations:{raphsvg:{type:b.Presentation.RaphSVG,container:"#canvasSVG",dataView:"drawspace",lenses:{shape:function(b,c,d,e){var f={},g=d.getItem(e),h,i,j,k=function(){i=h.attr("x"),j=h.attr("y")},l=function(a,b){var c={};d.updateItems([{id:e,posInfo:{x:a+i,y:b+j,w:h.attr("width"),h:h.attr("height")}}])},m=function(){};a("#testdone").append("<p>Raphael Object in data store:<br/> "+JSON.stringify(g)+"</p>"),g.shapeType[0]==="rect"&&(h=c.canvas.rect(g.posInfo[0].x,g.posInfo[0].y,g.posInfo[0].w,g.posInfo[0].h),h.attr({fill:"#888888",opacity:.25})),f.update=function(b){h.attr({x:b.posInfo[0].x,y:b.posInfo[0].y}),a("#testdone > p").empty().html("Raphael Object in data store:<br/> "+JSON.stringify(b))},h.drag(l,k,m);return f}},cWidth:d.width,cHeight:d.height}}}));e.ready(function(){var b=110,c=23;a("#loadrect").click(function(a){a.preventDefault(),e.dataStore.canvas.loadItems([{id:"rect1",type:"shape",shapeType:"rect",posInfo:{w:100,h:100,x:b,y:c}}])}),a("#updaterect").click(function(a){e.dataStore.canvas.updateItems([{id:"rect1",x:b+100,y:c+20}])})});return e},fluid.defaults("MITHGrid.Application.Canvas",{dataStores:{canvas:{types:{annotation:{},shape:{}},properties:{posInfo:{type:"Item"}}}}})}(jQuery,MITHGrid);